# 运行机制


## 1.工作空间-目录结构
Go 代码必须放在工作空间内。它其实就是一个目录，其中包含三个子目录：

- src 目录包含 Go 的源文件，它们被组织成包(每个目录都对应一个包)。通常包会含多种版本控制的代码仓库（例如Git或Mercurial)，以此来跟踪一个或多个源码包的开发。
- pkg 目录包含包对象。即：编译的库产物，以 “操作系统 + 架构” 的方式，对编译产物进行按文件夹分组。比如：静态库等。
- bin 目录包含可执行命令。即：编译后生成的可执行 bin 文件。

go 工具用于构建源码包，并将其生成的二进制文件安装到 pkg 和 bin 目录中。关于工具的使用，参见《工具链》部分。


## 2.程序执行
### 2.1 执行入口-main函数

### 2.2 初始化-init函数
init 函数先于 main 函数执行，实现包级别的一些初始化操作。特性如下：

- init 函数的主要作用：
    * 初始化不能采用初始化表达式初始化的变量。
    * 程序运行前的注册。
    * 实现 sync.Once 功能。

- init 函数的主要特点：
    * init 函数先于 main 函数自动执行，不能被其他函数调用；
    * init 函数没有输入参数、返回值；
    * 每个包可以有多个 init 函数；
    * 包的每个源文件也可以有多个 init 函数，这点比较特殊；
    * 同一个包的 init 执行顺序，golang 没有明确定义，编程时要注意程序不要依赖该执行顺序。
    * 不同包的 init 函数按照包导入的依赖关系决定执行顺序。

- golang 程序初始化：先于 main 函数执行，由 runtime 进行初始化，初始化顺序如下：
    * 初始化导入的包：
        * 包的初始化顺序并不是按导入顺序（“从上到下”）执行的；
        * runtime 需要解析包依赖关系，没有依赖的包最先初始化，与变量初始化依赖关系类似；
    * 初始化包作用域的变量：
        * 该作用域的变量的初始化也并非按照 “从上到下、从左到右” 的顺序，runtime 解析变量依赖关系，没有依赖的变量最先初始化；
    * 执行包的 init 函数；
    * **参考**：[golang变量的初始化](https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/PGDzMaYznZVuDiO6V-zYDw)


## 3.并发机制
- 进程(process)
- 线程(thread)
- 协程(goroutine，轻量级线程)
- 系统调用(syscall)
- 执行体之间消息传递的并发编程模型：有 “共享内存模型”（多数传统语言的选择）、“消息传递模型”（比如：Erlang） 两个流派。
- Erlang风格的并发模型，主题思想有两点：轻量级的进程(执行体)、消息是进程间通信的唯一方式。
